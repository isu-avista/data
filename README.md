# Avista-Data


## Description

This is the base data package upon which all other isu-avista projects rely. 
To better understand the design and concepts surrounding this project please
see the [main architecture wiki](https://github.com/isu-avista/architecture/wiki)
and this [project's wiki](https://github.com/isu-avista/data/wiki).

## Table of Contents

1. [Installation](#installation)
2. [Usage](#usage)
3. [Credits](#credits)
4. [License](#license)

## Installation

To install this use the following command.

```
pip3 install git+ssh://git@github.com/isu-avista/data.git
```

## Usage

### Working with the database

Before working with the classes in this module, you will need to prepare your database. Use the following commands to work with the database.

To add a new database migration use the following command from the project root directory:

```
flask db migrate -m message
```

To upgrade a database to the most recent migration use the following command from the project root directory:

```
flask db upgrade
```

To downgrade the database to a previous migration use the following command from the project root directory

```
flask db downgrade
```

### Module Initialization

Once you have the database setup you will need a flask app in order to initialize the module.

The code for this would look something like...

```python
import os
import avista_data
from flask import Flask

basedir = os.path.abspath(os.path.dirname(__file__))


class Config(object):
    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or \
                              'sqlite:///' + os.path.join(basedir, 'test.db')
    SQLALCHEMY_TRACK_MODIFICATIONS = False


app = Flask(__name__)
app.config.from_object(Config)
avista_data.init(app)
```

The idea here is that you need some form of database configuration, provided through a configuration object
or environment variables. You can then create the flask app (i.e., `app = Flask(__name__)`). Finally, you can
then initialize the `avista_data` module using `avista_data.init(app)`. (Note: don't forget the imports)

### Using the classes

Currently the data model is quite small and comprised of the following classes:

* **ApiKey** - Represents the API Keys of Users or Servers connected
* **ConfigItem** - Represents a Configuration Item
* **DataPoint** - Represents a Measured Value from a particular point in time
* **Device** - Represents the device hosting the service
* **Issue** - Represents an issue affecting monitored equipment
* **IssueType** - Enum representing the type of issue
* **PinOut** - Represents a RPi GPIO connection point for a Sensor
* **Role** - Enum defining roles for users
* **SecurityConfig** - Security Configuration of a service 
* **Sensor** - Sensor connected to an IoT device
* **Server** - Server connected to a device
* **ServerConfig** - Configuration of the running service
* **Status** - Status of the running service
* **Unit** - Enum defining different units of measurement
* **User** - Represents a User of the Service

The relationships between these classes can be seen through a review of the design documentation
on the wiki. Each class is essentially operated using the following methods (common to each class):

* `__init__(json)` - constructs a new instance and optionally populates its attributes with values from the json representation
* `update(json)` - updates an object instance to the values stored in the json representation
* `to_dict()` - returns a dictionary containing the values of the attributes of the object instance
* `get_attr()` - returns the value of some attribute `attr`
* `set_attr(...)` - sets the value of some attribute `attr` to the provided value in the arguments additionally this will commit the change to the database

For examples of usage we suggest reviewing the unit tests in the `tests/` directory of the project.

You can also see the complete documentation of the code on the [documentation page](https://isu-avista.github.io/data/).

### Generating Documentation

Documentation for this project can be generated by using the following commands.
To generate HTML documentation accessible from `sphinx/build/html` use the following:

```bash
cd sphinx
make html
``` 

To generate HTML documentation accessible at [https://isu-avista.github.io/data/index.html](project page),
use the following commands on the develop branch:

```bash
cd sphinx
make github
cd ..
git commit -m "message"
git push
```

## Credits

This module was contributed by:

- Isaac D. Griffith

## License

Copyright (c) 2020 Idaho State University Empirical Software Engineering Laboratory

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

